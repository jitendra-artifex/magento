<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2012 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<div class="block block-banner">
    <div class="block-content">
        <?php if(strtolower(substr($this->getLinkUrl(),0,4))==='http'): ?>
            <a href="<?php echo $this->getLinkUrl() ?>" title="<?php echo $this->__($this->getImgAlt()) ?>">
        <?php elseif($this->getLinkUrl()): ?>
            <a href="<?php echo $this->getUrl($this->getLinkUrl()) ?>" title="<?php echo $this->__($this->getImgAlt()) ?>">
        <?php endif; ?>
            <img src="<?php echo $this->getSkinUrl($this->getImgSrc()) ?>"<?php if(!$this->getLinkUrl()): ?> title="<?php echo $this->__($this->getImgAlt()) ?>"<?php endif; ?> alt="<?php echo $this->__($this->getImgAlt()) ?>" />
        <?php if($this->getLinkUrl()): ?>
        </a>
        <?php endif ?>
    </div>
</div>

<?php if($this->getRequest()->getControllerName()=='category'): ?>

<div class="block block-related">
	<div class="block-title">Wijnsuggesties</div>

<?php 
	
	$cat_id = Mage::getModel('catalog/layer')->getCurrentCategory()->getId();
	$category = Mage::getModel('catalog/category')->load($cat_id);
	
	$products = $category->getProductCollection()->addCategoryFilter($category)->addAttributeToSelect('*');
	
	$products->getSelect()->order('rand()')->limit('4');
	
	//print_r($products);
?>

	<div class="block-content">
		<ul>
		<?php foreach ($products as $_product): ?>	
            <li class="item">
                <div class="product-detail">
                	<div class="pro-dtl">
                    	<ul>
                        	<?php $brandname = Mage::getModel('catalog/product')->load($_product->getId())->getAttributeText('brand');?>
            				<?php $madein = Mage::getModel('catalog/product')->load($_product->getId())->getAttributeText('made_in');?>
            				<?php $bottle_size = Mage::getModel('catalog/product')->load($_product->getId())->getAttributeText('bottle_size');?>
                        	
                            <?php /*?><li class="product-name"><a href="<?php echo $_product->getProductUrl() ?>"><?php echo $this->htmlEscape($_product->getName()) ?></a></li><?php */?>
                            <li class="product-name"><?php echo $this->htmlEscape($_product->getName()) ?></li>
                            <li class="brand-name"><?php echo $brandname; ?></li>
                            <li class="how-old"><?php echo $madein; ?></li>
                            <li class="weight"><?php echo $bottle_size; ?></li>                            
                      	</ul>
                    </div>
                    <div class="price-box">
                    	
                        <?php
							$_coreHelper = $this->helper('core');
							$regularprice = $_coreHelper->currency($_product->getPrice(),true,false);
							$specialprice = $_coreHelper->currency($_product->getSpecialPrice(),true,false);
							$test = $_product->getSpecialPrice();
						?>
    
    					<?php if($test == '') { ?>
                        <div class="regular-price">					 
                            <div class="price"><?php echo $regularprice;?></div>
                        </div>
                        <?php } else { ?>
                        <div class="old-price">
                            <div class="price"><?php echo $regularprice;?></div>
                        </div>
                        <div class="special-price">
                            <div class="price"><?php echo $specialprice;?></div>
                        </div>
                        <?php } ?>                            
                    </div>
                                       
                    <div class="add-to-cart">
						<button type="button" class="button btn-cart" onclick="productAddToCartForm_<?php echo $_product->getId(); ?>.submit()"><span><span><?php echo $this->__('Add to Cart') ?></span></span></button>
					</div>
					<div class="cls"></div>
                </div>
                <div class="product-image">
                    <a href="<?php echo $_product->getProductUrl() ?>"><img src="<?php echo $this->helper('catalog/image')->init($_product, 'thumbnail')->resize(30, 124) ?>" alt="<?php echo $this->htmlEscape($_product->getName()) ?>" width="30" height="124" /></a>
                    <?php require('media_labels_listpage.phtml'); ?>
                </div>
                <div class="cls"></div>                 
            </li>
            <?php endforeach; ?>
		</ul>
	</div>

</div>

<?php endif; ?>

<div class="block">
	<?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('home_sidebar_block_1')->toHtml() ?>
</div>
<div class="block">
    <?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('home_sidebar_block_2')->toHtml() ?>         
</div> 
<div class="block">
    <?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('home_sidebar_block_3')->toHtml() ?>
</div>
<div class="block">
    <?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('home_sidebar_block_4')->toHtml() ?>
</div>
<div class="block">
    <?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('home_sidebar_block_5')->toHtml() ?>
</div>